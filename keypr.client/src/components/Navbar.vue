<template>
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <router-link class="navbar-brand d-flex" :to="{ name: 'Home' }">
      <div class="d-flex flex-column align-items-center">
        <svg xmlns="http://www.w3.org/2000/svg"
             x="0px"
             y="0px"
             class="hoverSpin"
             width="60"
             height="50"
             viewBox="0 0 226 226"
             style=" fill:#000000;"
        ><g fill="none"
            fill-rule="nonzero"
            stroke="none"
            stroke-width="1"
            stroke-linecap="butt"
            stroke-linejoin="miter"
            stroke-miterlimit="10"
            stroke-dasharray=""
            stroke-dashoffset="0"
            font-family="none"
            font-weight="none"
            font-size="none"
            text-anchor="none"
            style="mix-blend-mode: normal"
        ><path d="M0,226v-226h226v226z" fill="none"></path><g><path d="M192.47961,35.51996c12.77007,12.77027 12.86946,33.44389 0.22276,46.33636c-12.64669,12.89246 -33.3184,13.19094 -46.33206,0.669c-0.15449,-0.14566 -0.30457,-0.29133 -0.45465,-0.44141l-9.10621,-9.10621c-0.35313,-0.35313 -0.69742,-0.71508 -1.02848,-1.08145c-12.0731,-13.21131 -11.38158,-33.64721 1.55698,-46.01216c12.93856,-12.36495 33.3848,-12.12971 46.03545,0.52966zM181.81965,71.41953c6.95762,-6.97372 6.95565,-18.26391 -0.00441,-25.2352l-9.10621,-9.10621c-6.96851,-6.96851 -18.26669,-6.96851 -25.2352,0c-6.96851,6.96851 -6.96851,18.26669 0,25.2352l9.10621,9.10621c6.97422,6.95887 18.26539,6.95887 25.23961,0z" fill="#ffd700"></path><path d="M146.37031,82.52531l-0.00441,0.00441l-40.57848,40.57406l15.92152,15.92152l-7.80406,7.79965l-15.91711,-15.91711l-4.68332,4.68332l11.86059,11.86059l-7.80406,7.80406l-11.86059,-11.86059l-4.68332,4.67891l16.23051,16.23051l-7.79965,7.80406l-26.84191,-26.84191l73.34848,-73.34848l0.02648,-0.02207c0.33105,0.36637 0.67535,0.72832 1.02848,1.08145l9.10621,9.10621c0.15008,0.15008 0.30016,0.29574 0.45465,0.44141z" fill="#ffd700"></path><path d="M154.70671,73.29154c8.00263,8.003 20.97775,8.00329 28.98075,0.00066c8.003,-8.00263 8.00329,-20.97775 0.00066,-28.98075l-9.10577,-9.14329c-3.83081,-3.8655 -9.04832,-6.03861 -14.49048,-6.03535h-0.00265c-5.47829,0 -10.4525,2.20394 -14.42516,6.06845v0c-3.90336,3.80557 -6.08057,9.04193 -6.02608,14.49313c-0.02416,5.43544 2.12902,10.65426 5.97885,14.49137zM149.34716,38.9082c2.83996,-2.86595 6.70734,-4.47831 10.74206,-4.47851v0c4.03653,0.00051 7.90533,1.61475 10.74515,4.48336l9.10709,9.12563c2.85774,2.84762 4.45819,6.7197 4.44496,10.75398c0.02604,8.42756 -6.76105,15.29295 -15.18835,15.36359v0c-4.04126,-0.01692 -7.90856,-1.64637 -10.74339,-4.52662l-9.10886,-9.14814c-5.92464,-5.97079 -5.92464,-15.6025 0,-21.57329z" fill="#000000"></path><path d="M60.53313,147.13968l26.84191,26.84191c0.49671,0.49691 1.17051,0.77609 1.87311,0.77609c0.7026,0 1.3764,-0.27918 1.87311,-0.77609l7.79965,-7.80406c1.0339,-1.03421 1.0339,-2.71068 0,-3.74489l-14.35718,-14.35674l0.93622,-0.93534l9.98858,9.98902c1.03426,1.0342 2.71107,1.0342 3.74533,0l7.8045,-7.8045c1.0342,-1.03426 1.0342,-2.71107 0,-3.74533l-9.98858,-9.98858l0.93799,-0.93799l14.04422,14.04466c1.03421,1.0339 2.71068,1.0339 3.74489,0l7.80406,-7.79965c0.49691,-0.49671 0.77609,-1.17051 0.77609,-1.87311c0,-0.7026 -0.27918,-1.3764 -0.77609,-1.87311l-14.04775,-14.0482l36.9457,-36.94173c6.37364,5.31553 14.41506,8.21775 22.71432,8.1978c0.10829,0 0.21658,0 0.32487,0c14.32326,-0.13435 27.16869,-8.84633 32.59147,-22.10405c5.42278,-13.25772 2.36493,-28.47459 -7.7584,-38.60829l-9.10489,-9.10533c-13.32057,-13.31791 -34.71433,-13.94167 -48.78822,-1.42248c-14.07389,12.51919 -15.94732,33.83989 -4.27234,48.62161l-71.65259,71.65259c-0.49678,0.49669 -0.77587,1.1704 -0.77587,1.87289c0,0.70249 0.27909,1.3762 0.77587,1.87289zM138.68234,28.28664c11.8317,-11.80552 30.98692,-11.80552 42.81861,0l9.10621,9.10621c11.80283,11.83195 11.80283,30.98446 0,42.81641c-11.58294,11.58338 -30.60358,11.76613 -42.41914,0.38711c-0.13595,-0.12801 -0.26793,-0.25646 -0.39727,-0.38711l-9.10533,-9.10533c-0.32355,-0.32399 -0.63916,-0.65549 -0.93666,-0.98522l-0.01059,-0.01104c-10.94677,-11.93959 -10.53028,-30.38763 0.94417,-41.82104zM135.75229,75.66586l6.86607,6.86607l-38.70338,38.69897c-0.49678,0.49669 -0.77587,1.1704 -0.77587,1.87289c0,0.70249 0.27909,1.3762 0.77587,1.87289l14.04864,14.0482l-4.05785,4.0552l-14.04466,-14.04511c-1.03426,-1.0342 -2.71107,-1.0342 -3.74533,0l-4.68376,4.68376c-1.0342,1.03426 -1.0342,2.71107 0,3.74533l9.98814,9.9877l-4.05873,4.05873l-9.9877,-9.98814c-1.03421,-1.0339 -2.71068,-1.0339 -3.74489,0l-4.68332,4.67891c-0.49705,0.49673 -0.77631,1.17062 -0.77631,1.87333c0,0.7027 0.27926,1.3766 0.77631,1.87333l14.3585,14.35806l-4.0552,4.05785l-23.09746,-23.09702z" fill="#000000"></path><path d="M60.53357,165.8659l-15.92152,15.91711c-0.67823,0.66711 -0.94655,1.64674 -0.70293,2.56635c0.24362,0.91961 0.96175,1.63791 1.8813,1.88175c0.91955,0.24384 1.89924,-0.02425 2.56652,-0.70233l15.92152,-15.91711c1.02004,-1.03655 1.01346,-2.7017 -0.01475,-3.73015c-1.02821,-1.02845 -2.69335,-1.03543 -3.73014,-0.01563z" fill="#000000"></path><path d="M47.735,96.26496c-1.03437,-1.03437 -2.71141,-1.03437 -3.74577,0c-1.03437,1.03437 -1.03437,2.71141 0,3.74577l15.91711,15.91711c1.03437,1.03437 2.71141,1.03437 3.74577,0c1.03437,-1.03437 1.03437,-2.71141 0,-3.74577z" fill="#000000"></path><path d="M117.6511,169.92287c-1.0342,1.03426 -1.0342,2.71107 0,3.74533l15.91843,15.91579c1.03424,1.03437 2.71119,1.03447 3.74555,0.00022c1.03437,-1.03424 1.03447,-2.71119 0.00022,-3.74555l-15.91755,-15.91667c-0.49684,-0.49693 -1.17081,-0.77603 -1.87351,-0.77587c-0.7027,0.00017 -1.37654,0.27959 -1.87315,0.77675z" fill="#000000"></path><path d="M21.1875,143.45703c0,1.46269 1.18575,2.64844 2.64844,2.64844h22.51172c1.46269,0 2.64844,-1.18575 2.64844,-2.64844c0,-1.46269 -1.18575,-2.64844 -2.64844,-2.64844h-22.51172c-1.46269,0 -2.64844,1.18575 -2.64844,2.64844z" fill="#000000"></path><path d="M157.58203,143.45703c0,-1.46269 -1.18575,-2.64844 -2.64844,-2.64844h-22.51172c-1.46269,0 -2.64844,1.18575 -2.64844,2.64844c0,1.46269 1.18575,2.64844 2.64844,2.64844h22.51172c1.46269,0 2.64844,-1.18575 2.64844,-2.64844z" fill="#000000"></path><path d="M92.25391,100.64063v-22.51172c0,-1.46269 -1.18575,-2.64844 -2.64844,-2.64844c-1.46269,0 -2.64844,1.18575 -2.64844,2.64844v22.51172c0,1.46269 1.18575,2.64844 2.64844,2.64844c1.46269,0 2.64844,-1.18575 2.64844,-2.64844z" fill="#000000"></path><path d="M86.95703,186.71484v22.51172c0,1.46269 1.18575,2.64844 2.64844,2.64844c1.46269,0 2.64844,-1.18575 2.64844,-2.64844v-22.51172c0,-1.46269 -1.18575,-2.64844 -2.64844,-2.64844c-1.46269,0 -2.64844,1.18575 -2.64844,2.64844z" fill="#000000"></path></g></g></svg>
      </div>
      <h2 class="text-white">
        Keypr
      </h2>
    </router-link>
    <button
      class="navbar-toggler"
      type="button"
      data-toggle="collapse"
      data-target="#navbarText"
      aria-controls="navbarText"
      aria-expanded="false"
      aria-label="Toggle navigation"
    >
      <span class="navbar-toggler-icon" />
    </button>
    <div class="collapse navbar-collapse" id="navbarText">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item">
          <router-link :to="{ name: 'Home' }" class="nav-link">
            Home
          </router-link>
        </li>
        <li class="nav-item">
          <router-link :to="{ name: 'About' }" class="nav-link">
            About
          </router-link>
        </li>
      </ul>
      <span class="navbar-text">
        <button
          class="btn btn-outline-primary text-uppercase"
          @click="login"
          v-if="!user.isAuthenticated"
        >
          Login
        </button>

        <div class="dropdown" v-else>
          <div
            class="dropdown-toggle"
            @click="state.dropOpen = !state.dropOpen"
          >
            <img
              :src="user.picture"
              alt="user photo"
              height="40"
              class="rounded-circle"
            />
            <span class="mx-3">{{ user.name }}</span>
          </div>
          <div
            class="dropdown-menu p-0 list-group w-100"
            :class="{ show: state.dropOpen }"
            @click="state.dropOpen = false"
          >
            <router-link :to="{ name: 'Account' }">
              <div class="list-group-item list-group-item-action hoverable">
                Account
              </div>
            </router-link>
            <div
              class="list-group-item list-group-item-action hoverable"
              @click="logout"
            >
              logout
            </div>
          </div>
        </div>
      </span>
    </div>
  </nav>
</template>

<script>
import { AuthService } from '../services/AuthService'
import { AppState } from '../AppState'
import { computed, reactive } from 'vue'
export default {
  setup() {
    const state = reactive({
      dropOpen: false
    })
    return {
      state,
      user: computed(() => AppState.user),
      async login() {
        AuthService.loginWithPopup()
      },
      async logout() {
        AuthService.logout({ returnTo: window.location.origin })
      }
    }
  }
}
</script>

<style scoped>
.dropdown-menu {
  user-select: none;
  display: block;
  transform: scale(0);
  transition: all 0.15s linear;
}
.dropdown-menu.show {
  transform: scale(1);
}
.hoverable {
  cursor: pointer;
}
a:hover {
  text-decoration: none;
}
.hoverSpin:hover {
  cursor: default;
    transform: rotate(360deg);
    transition: all 0.3s ease-in-out 0.1s;
}
.nav-link{
  text-transform: uppercase;
}
.nav-item .nav-link.router-link-exact-active{
  color: var(--light);
}
</style>
